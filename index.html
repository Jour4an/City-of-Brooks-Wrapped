<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brooks Property Tax Year in Review - Estimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Wrapped Theme Colors */
            --color-wrapped-bg: #121212; /* Very Dark Background */
            --color-wrapped-card: #282828; /* Dark Card Background */
            --color-wrapped-primary: #1ed760; /* Teal/Green Accent (Spotify Green) */
            --color-wrapped-secondary: #ff3371; /* Hot Pink Accent */
            --color-wrapped-tertiary: #a980ff; /* Deep Violet Accent */
            --color-wrapped-text: #ffffff;
            --color-wrapped-text-dim: #c0c0c0;
        }
        
        /* Set base for full-screen, scrollable experience */
        html, body {
            height: 100%;
            width: 100%;
            overflow-y: auto; /* Allow main body scrolling */
            margin: 0;
            padding: 0;
            background-color: var(--color-wrapped-bg);
            font-family: 'Inter', sans-serif;
            color: var(--color-wrapped-text);
            scroll-behavior: smooth; /* Smooth scrolling between snap points */
        }
        
        .wrapped-container {
            /* Full screen width and height on ALL devices */
            width: 100%; 
            max-width: none; 
            overflow-y: scroll; /* Makes this the scroll-snap container */
            scroll-snap-type: y mandatory; /* Ensures it snaps to full pages */
            position: relative;
            background: var(--color-wrapped-card);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            /* Important: We set min-height to 100vh just to start the scrolling behavior correctly */
            min-height: 100vh;
        }
        
        .content-wrapper {
            max-width: 80rem; /* Wide constraint for desktop content */
            width: 100%;
            height: 100%;
            margin-left: auto;
            margin-right: auto;
            padding: 0 40px; /* Side padding on desktop */
        }

        /* Removed #slide-wrapper */
        
        .slide-page {
            /* Each section is a full viewport height page */
            height: 100vh;
            min-height: 500px; /* Minimum height for very small devices */
            padding: 40px 0; 
            display: flex;
            flex-direction: column;
            justify-content: center; 
            position: relative;
            background: var(--color-wrapped-card); 
            flex-shrink: 0; 
            scroll-snap-align: start; /* Snap point for scroll-snap */
        }
        
        /* Specific override for Page 4 to allow internal scrolling if content is too dense */
        #page-4 .content-wrapper {
            justify-content: flex-start; 
            padding-top: 60px; 
            padding-bottom: 80px; 
            overflow-y: auto; /* Allow scrolling ONLY on this page */
            display: block; 
        }
        
        /* General Mobile adjustment for inner content */
        @media (max-width: 768px) {
            .content-wrapper {
                padding: 0 20px; /* Tighter padding on mobile */
            }
        }

        .input-card {
            background-color: #3e3e3e;
        }
        
        /* Input field style */
        #assessmentInput {
            -webkit-appearance: none;
            -moz-appearance: textfield;
            font-family: 'Montserrat', sans-serif; 
            letter-spacing: 0.05em; 
            color: var(--color-wrapped-text);
            background-color: #4a4a4a;
        }
        
        .title-montserrat {
            font-family: 'Montserrat', sans-serif;
        }

        /* Utility for text colors */
        .text-wrapped-primary { color: var(--color-wrapped-primary); }
        .text-wrapped-secondary { color: var(--color-wrapped-secondary); }

        /* Navigation buttons are removed, so this container is empty */
        .nav-buttons-container { display: none; } 
    </style>
</head>
<body class="p-0">
    
    <!-- Navigation Controls Container (Empty as we use scroll) -->
    <div class="nav-buttons-container"></div>
    
    <!-- Main Wrapped Container (Full screen) -->
    <div id="wrapped-content" class="wrapped-container border-4 border-white/10">

        <!-- Slides now flow vertically (no slide-wrapper needed) -->

        <!-- PAGE 1: HEADER & INPUT -->
        <div id="page-1" class="slide-page">
            <div class="content-wrapper flex flex-col items-center justify-center">
                <div class="text-center mb-6 max-w-2xl">
                    <h2 class="text-xl font-bold uppercase tracking-widest text-white/70 mb-1 title-montserrat">
                        City of Brooks
                    </h2>
                    <h1 class="text-6xl sm:text-7xl font-black title-montserrat" 
                        style="line-height: 0.95; color: var(--color-wrapped-primary);">
                        YEAR IN REVIEW
                    </h1>
                    <p class="text-lg font-medium mt-3 text-white/90 max-w-sm mx-auto">
                        Ever wondered where **your property taxes** went? Here‚Äôs your personalized breakdown‚Äîjust enter your assessment!
                    </p>
                </div>
                <!-- Section 1: Assessment Input -->
                <div class="mb-10 input-card p-6 rounded-xl text-center max-w-md w-full">
                    <label for="assessmentInput" class="text-base font-medium block mb-3 text-white/80 font-inter">
                        1. Start Here: Enter Your Property Assessment Value (CAD)
                    </label>
                    <div class="flex justify-center items-center">
                        <span class="text-5xl mr-2 text-wrapped-primary font-bold title-montserrat">$</span>
                        <input
                            type="text"
                            id="assessmentInput"
                            value="350,000"
                            min="1"
                            class="text-5xl font-black p-3 w-64 text-center border-0 rounded-lg focus:ring-4 focus:ring-wrapped-secondary transition duration-150 title-montserrat"
                            oninput="formatAssessmentInput(this); calculateTaxes();"
                        >
                    </div>
                    <p class="text-xs mt-3 text-white/50 text-center font-inter">
                        Based on **Estimated** 2025 Mill Rate: <span id="millRateDisplay2025" class="font-bold text-white/70"></span> per $1,000
                    </p>
                </div>
                <!-- Disclaimer and Footnote -->
                <div class="mt-auto pt-8 text-center max-w-2xl">
                    <p class="text-sm font-semibold text-white/60 mb-2">
                        This is an **estimate** based on the proposed budget. Your final tax notice may vary.
                    </p>
                    <p class="text-xs text-white/40">
                        Disclaimer: For reference only‚Äîthe **final, audited numbers for this period will be available in March**. This breakdown is based on the proposed 2025 budget.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- PAGE 2: TOTAL TAX BILL REVEAL -->
        <div id="page-2" class="slide-page">
            <div class="content-wrapper flex flex-col items-center justify-center text-center">
                <h3 class="text-2xl font-semibold uppercase text-white/70 tracking-wider mb-6">
                    2. The Headline Stat
                </h3>
                <p class="text-3xl sm:text-4xl font-bold mb-4">
                    Your Total Property Tax Bill Was...
                </p>
                <span id="totalTaxDisplay" class="text-7xl md:text-8xl font-extrapold mt-3 block title-montserrat" style="color: var(--color-wrapped-secondary); transition: color 0.5s;"></span>
                <p class="text-xl mt-6 text-white/80">
                    That's your estimated contribution to the City of Brooks for the year.
                </p>
            </div>
        </div>

        <!-- PAGE 3: PRIMARY ALLOCATION (The Big Three) -->
        <div id="page-3" class="slide-page">
            <div class="content-wrapper flex flex-col items-center justify-center text-center">
                <h3 class="text-3xl font-black text-white/90 title-montserrat mb-6">
                    3. Where Your Dollars Went
                </h3>
                <p class="text-xl text-white/70 mb-8 font-inter">
                    This is how your estimated total tax of <span id="taxValuePlaceholder" class="font-extrabold text-wrapped-secondary">$0.00</span> was divided:
                </p>
                <div id="primaryBreakdown" class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center max-w-5xl w-full">
                    <!-- Cards generated here by JS -->
                </div>
            </div>
        </div>
        
        <!-- PAGE 4: MUNICIPAL DEEP DIVE -->
        <div id="page-4" class="slide-page">
            <div class="content-wrapper">
                <h3 class="text-3xl font-black mb-4 text-white/90 title-montserrat">
                    4. Departments Funded
                </h3>
                <p class="text-lg text-white/70 mb-6 font-inter">
                    Your Municipal portion of <span id="municipalValuePlaceholder" class="font-extrabold text-wrapped-primary">$0.00</span> went to these departments:
                </p>
                <!-- Chart Container: CONDENSED SPACING -->
                <div id="departmentBreakdownChart" class="space-y-3">
                    <!-- Bar Chart generated here by JS -->
                </div>
                <p class="text-sm text-white/60 mt-4 text-center">
                    (Departments funded by your municipal tax portion)
                </p>
            </div>
        </div>

        <!-- PAGE 5: UTILITIES -->
        <div id="page-5" class="slide-page">
            <div class="content-wrapper flex flex-col items-center justify-center text-center">
                <h3 class="text-3xl font-black mb-6 text-white/90 title-montserrat">
                    5. Utilities Keep Brooks Flowing
                </h3>
                <p class="text-xl text-white/70 mb-10 font-inter">
                    Your utility fees ensure these essential services run year-round:
                </p>
                <ul class="space-y-6 max-w-3xl w-full">
                    <li class="flex items-center p-4 rounded-xl border border-white/20 hover:border-wrapped-primary transition duration-300 text-left" style="background-color: #2e2e2e;">
                        <span class="text-4xl mr-4 leading-none">üíß</span>
                        <span class="font-bold text-xl">Water Supply & Treatment</span>
                    </li>
                    <li class="flex items-center p-4 rounded-xl border border-white/20 hover:border-wrapped-primary transition duration-300 text-left" style="background-color: #2e2e2e;">
                        <span class="text-4xl mr-4 leading-none">‚ôªÔ∏è</span>
                        <span class="font-bold text-xl">Sewer & Wastewater Management</span>
                    </li>
                    <li class="flex items-center p-4 rounded-xl border border-white/20 hover:border-wrapped-primary transition duration-300 text-left" style="background-color: #2e2e2e;">
                        <span class="text-4xl mr-4 leading-none">üóëÔ∏è</span>
                        <span class="font-bold text-xl">Garbage & Yard Waste Collection</span>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- PAGE 6: 2025 PROJECTS -->
        <div id="page-6" class="slide-page">
            <div class="content-wrapper flex flex-col items-center justify-center text-center">
                <h3 class="text-3xl font-black mb-6 text-white/90 title-montserrat">
                    6. Projects Completed in 2025
                </h3>
                <p class="text-xl text-white/70 mb-8 font-inter">
                    Infrastructure and community projects funded by your 2025 tax contribution:
                </p>
                <ul class="space-y-4 max-w-3xl w-full text-left">
                    <li class="flex items-start text-white/80 p-3 rounded-md border-l-4 border-wrapped-secondary">
                        <span class="text-wrapped-secondary mr-3 text-xl leading-none">üöß</span>
                        <span class="font-semibold text-lg">Annual Street Improvement (Roads and Paving)</span>
                    </li>
                    <li class="flex items-start text-white/80 p-3 rounded-md border-l-4 border-wrapped-primary">
                        <span class="text-wrapped-primary mr-3 text-xl leading-none">üå≥</span>
                        <span class="font-semibold text-lg">Trail Beautification (New Landscaping and Benches)</span>
                    </li>
                    <li class="flex items-start text-white/80 p-3 rounded-md border-l-4 border-wrapped-tertiary">
                        <span class="text-wrapped-tertiary mr-3 text-xl leading-none">üõπ</span>
                        <span class="font-semibold text-lg">Skateboard Park (New Installation & Concrete Work)</span>
                    </li>
                    <li class="flex items-start text-white/80 p-3 rounded-md border-l-4 border-wrapped-secondary">
                        <span class="text-wrapped-secondary mr-3 text-xl leading-none">üí¶</span>
                        <span class="font-semibold text-lg">Uplands Spray Park (Refurbishment and Feature Upgrades)</span>
                    </li>
                </ul>
            </div>
        </div>
        <!-- === END SLIDES === -->
    </div>

    <script>
        // --- SCROLL SNAP LOGIC (Minimal cleanup, relying on CSS) ---
        // Removed custom navigation functions (nextPage, prevPage) and keyboard handlers
        
        window.addEventListener('resize', () => {
             // In scroll-snap, we don't need to manually update position, but running
             // calculateTaxes ensures the display is fresh if anything depends on it.
             calculateTaxes();
        });
        
        // --- CONSTANTS ---
        const RAW_MILL_RATE_2025 = 10.961423;
        const MILL_RATE_PER_DOLLAR_2025 = RAW_MILL_RATE_2025 / 1000; 
        
        // Primary Tax Breakdown (of Total Tax Bill)
        const PRIMARY_BREAKDOWN = [
            { name: "Municipal", percentage: 0.77, color: 'var(--color-wrapped-primary)', icon: 'üè†' },
            { name: "Education", percentage: 0.22, color: 'var(--color-wrapped-secondary)', icon: 'üìö' },
            { name: "Newell Fdn", percentage: 0.01, color: 'var(--color-wrapped-tertiary)', icon: 'üëµ' }
        ];
        
        // Departmental Breakdown (of the MUNICIPAL PORTION ONLY - 77% of total tax)
        const DEPARTMENT_BREAKDOWN = [
            { name: "Policing", cents: 21.0, color: "#904CFF" }, 
            { name: "Recreation", cents: 17.2, color: "#00E0C7" }, 
            { name: "Transportation", cents: 16.7, color: "#FF6B6B" }, 
            { name: "Administration", cents: 11.0, color: "#FFA600" }, 
            { name: "Parks & Green Space", cents: 6.5, color: "#5FDD90" }, 
            { name: "Culture and Facilities", cents: 5.3, color: "#FF98D4" }, 
            { name: "Fiscal and Taxation", cents: 5.1, color: "#6A5ACD" }, 
            { name: "Fire Services", cents: 4.11, color: "#F08080" }, 
            { name: "Community Support Services", cents: 3.3, color: "#4682B4" }, 
            { name: "Municipal Enforcement", cents: 2.1, color: "#DEB887" }, 
            { name: "Planning and Development", cents: 2.0, color: "#DDA0DD" }, 
            { name: "Council", cents: 1.8, color: "#ADD8E6" }, 
            { name: "Economic Development", cents: 1.1, color: "#98FB98" }, 
            { name: "Access Transit", cents: 1.0, color: "#7B68EE" }, 
            { name: "Land", cents: 0.5, color: "#B0C4DE" }, 
            { name: "Cemetery", cents: 0.5, color: "#A9A9A9" }, 
            { name: "Engineering", cents: 0.4, color: "#FAEBD7" }, 
            { name: "Airport", cents: 0.4, color: "#DCDCDC" }, 
        ].sort((a, b) => b.cents - a.cents); 


        // --- UTILITY FUNCTIONS ---

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-CA', {
                style: 'currency',
                currency: 'CAD',
                minimumFractionDigits: 2,
            }).format(amount);
        }

        function formatAssessmentInput(input) {
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            let value = input.value.replace(/[^0-9]/g, '');

            if (value === '') {
                input.value = '';
                return;
            }

            const number = parseInt(value, 10);
            const formattedValue = new Intl.NumberFormat('en-CA').format(number);

            input.value = formattedValue;

            const newLength = formattedValue.length;
            const oldLength = oldValue.length;
            const difference = newLength - oldLength;

            if (cursorPosition !== null) {
                input.setSelectionRange(cursorPosition + difference, cursorPosition + difference);
            }
        }

        // --- MAIN CALCULATOR LOGIC ---
        function calculateTaxes() {
            const inputElement = document.getElementById('assessmentInput');
            const assessmentValue = parseFloat(inputElement.value.replace(/[^0-9.]/g, ''));

            document.getElementById('millRateDisplay2025').textContent = RAW_MILL_RATE_2025.toFixed(8);

            if (isNaN(assessmentValue) || assessmentValue <= 0) {
                document.getElementById('totalTaxDisplay').textContent = formatCurrency(0);
                document.getElementById('primaryBreakdown').innerHTML = '<p class="text-red-400">Please enter a valid assessment value.</p>';
                document.getElementById('departmentBreakdownChart').innerHTML = '';
                
                document.getElementById('taxValuePlaceholder').textContent = formatCurrency(0);
                document.getElementById('municipalValuePlaceholder').textContent = formatCurrency(0);
                return;
            }

            // 1. Calculate Total Tax
            const totalTax = assessmentValue * MILL_RATE_PER_DOLLAR_2025;
            document.getElementById('totalTaxDisplay').textContent = formatCurrency(totalTax);
            document.getElementById('taxValuePlaceholder').textContent = formatCurrency(totalTax);
            
            // 2. Primary Breakdown
            updatePrimaryBreakdown(totalTax);

            // 3. Departmental Breakdown (based on Municipal Share)
            const municipalPortion = totalTax * PRIMARY_BREAKDOWN[0].percentage;
            document.getElementById('municipalValuePlaceholder').textContent = formatCurrency(municipalPortion);
            updateDepartmentBreakdownChart(municipalPortion);
        }


        // --- WRAPPED VISUALIZATION RENDERING ---

        function updatePrimaryBreakdown(totalTax) {
            const breakdownHtml = PRIMARY_BREAKDOWN.map(item => {
                const shareAmount = totalTax * (item.percentage);

                return `
                    <div class="p-6 rounded-xl shadow-lg border border-white/10 transition duration-300 hover:border-wrapped-primary" style="background-color: var(--color-wrapped-card);">
                        <div class="text-5xl mb-3">${item.icon}</div>
                        <p class="text-xl font-bold title-montserrat uppercase" style="color:${item.color};">${item.name}</p>
                        <p class="text-3xl font-black mt-1 title-montserrat text-white">${formatCurrency(shareAmount)}</p>
                        <p class="text-base text-white/50 mt-1">${(item.percentage * 100).toFixed(0)}% of Bill</p>
                    </div>
                `;
            }).join('');

            document.getElementById('primaryBreakdown').innerHTML = breakdownHtml;
        }

        function updateDepartmentBreakdownChart(municipalPortion) {
            const allDepartments = DEPARTMENT_BREAKDOWN; 
            const maxCents = allDepartments[0].cents; 

            const chartHtml = allDepartments.map((item, index) => {
                const percentageOfMunicipal = item.cents / 100;
                const shareAmount = municipalPortion * percentageOfMunicipal;
                
                // Scale bar width based on the highest category (Policing)
                const barWidth = (item.cents / maxCents) * 100;
                
                // CONDENSED STYLES
                return `
                    <div class="flex flex-col">
                        <div class="flex justify-between items-end mb-1">
                            <!-- text-base for name on desktop, sm on mobile -->
                            <span class="text-sm md:text-base font-semibold text-white/90">${index + 1}. ${item.name}</span>
                            <!-- text-xl for amount on desktop, lg on mobile -->
                            <span class="text-lg md:text-xl font-black title-montserrat whitespace-nowrap" style="color: ${item.color};">${formatCurrency(shareAmount)}</span>
                        </div>
                        <!-- h-3 for bar -->
                        <div class="h-3 rounded-full bg-white/10 overflow-hidden shadow-inner">
                            <div 
                                class="h-full rounded-full transition-all duration-500" 
                                style="width: ${barWidth}%; background-color: ${item.color};"
                            ></div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('departmentBreakdownChart').innerHTML = chartHtml;
        }
        
        // Initialize the calculator and slides on load
        window.onload = () => {
            const inputElement = document.getElementById('assessmentInput');
            formatAssessmentInput(inputElement);
            calculateTaxes();
        };

    </script>

</body>
</html>